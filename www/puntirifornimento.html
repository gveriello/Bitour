<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"
              rel="stylesheet" type="text/css">
        <link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css"
              rel="stylesheet" type="text/css">

        <link href="http://www.gveriello.altervista.org/accesspoint/css/loader.css" rel="stylesheet">
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="js/moduli.js"></script>
        <script>
            $(document).ready(function(){
                $('[data-toggle="tooltip"]').tooltip(); 
            });
        </script>
    </head>
    <body style="overflow-x: hidden;">
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <label class="navbar-brand"><a onClick="window.history.back();"><img src="img/back-icon.png"></a> <a href="farmacie.html" style="color:black">BitonTour Official</a></label>
                </div>
                <div class="collapse navbar-collapse" id="navbar-ex-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="puntirifornimento.html">Aggiorna informazioni</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><br><br><br><br>
        <ul class="nav nav-tabs">
            <li class="active">
                <a data-toggle="tab" href="#benzineTab">
                    <label style="color:black; font-size: 25px" id="titoloBenzine">Punti di rifornimento</label>
                </a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="benzineTab" class="tab-pane fade in active">
                <div class="panel-group"  style="overflow: hidden;">
                    <p id="nessunaBenzina"></p>
                    <div id="loaderBenzine">
                        <div id="cssLoader4" class="main-wrap">
                            <div class="loader">
                                <div class="child-common child1"></div>
                                <div class="child-common child2" style="left:20px;"></div>
                                <div class="child-common child3" style="left:40px;"></div>
                                <div class="child-common child4" style="left:60px;"></div>
                                <div class="child-common child5" style="left:80px;"></div>
                            </div>            
                        </div>
                        <p class="text-center" id="titoloLoader">Sto scaricando i dati...</p>
                    </div>
                    <div class="list-group" id="benzine">
                    </div>
                </div>
            </div>
        </div>
        <script>
            var div = '';
            if (!checkConnection()){
                alert('Devi essere connesso a internet per poter utilizzare Bitontour.');
            }else{
                $("#loaderBenzine").show();
                //BENZINE-------------------------------------------------------------------
                //recupero i dati sulle benzine
                var responso = getBenzine();
                var num = 0;
                num = responso.locations.length;
                //se lo status è success
                if (num > 0){
                    var colonne = 0;
                    //le seguenti variabili le inizializzo a 9.000 perchè farò il confronto con dei prezzi minori
                    var pompaBenzinaE = 9.000; //ci metterò il prezzo della pompa che ha la benzina meno cara
                    var pompaGasolioE = 9.000; //ci metterò il prezzo della pompa che ha il diesel meno caro
                    var pompaMetanoE = 9.000; //ci metterò il prezzo della pompa che ha il metano meno caro
                    var pompaGplE = 9.000; //ci metterò il prezzo della pompa che ha il gpl meno caro

                    var iBenzina = 0; //indice della pompa con la benzina meno cara
                    var iGasolio = 0; //indice della pompa con il diesel meno caro
                    var iGpl = 0; //indice della pompa con il gpl meno caro
                    var iMetano = 0; //indice della pompa con il metano meno caro
                    for(i = 0; i < num; i++){ //ciclo for che controllerà i prezzi più bassi delle pompe
                        if (getBenzSelf(responso, i) > 0 && getBenzSelf(responso, i) < pompaBenzinaE){
                            pompaBenzinaE = getBenzSelf(responso, i);
                            iBenzina = i;
                        }
                        if (getGasolioSelf(responso, i) > 0 && getGasolioSelf(responso, i) < pompaGasolioE){
                            pompaGasolioE = getGasolioSelf(responso, i);
                            iGasolio = i;
                        }
                        if (getGpl(responso, i) > 0 && getGpl(responso, i) < pompaGplE){
                            pompaGplE = getGpl(responso, i);
                            iGpl = i;
                        }
                        if (getMetano(responso, i) > 0 && getMetano(responso, i) < pompaMetanoE){
                            pompaMetanoE = getMetano(responso, i);
                            iMetano = i;
                        }
                    }
                    i = 0;
                    for(i = 0; i < num; i++){
                        colonne = 0;
                        if (getBenzServito(responso, i) > 0 || getBenzSelf(responso, i) > 0) colonne++;
                        if (getGasolioServito(responso, i) > 0 || getGasolioSelf(responso, i) > 0) colonne++;
                        if (getGpl(responso, i) > 0) colonne++;
                        if (getMetano(responso, i) > 0) colonne++;
                        colonne = 12 / colonne;
                        div = '';
                        div += '<div class="card text-center">';
                        div += '<div class="card-block">';
                        div += '<h4 class="card-title">'+getCompany(responso, i)+'</h4>';
                        div += '<h6 class="card-subtitle text-muted">'+getIndirizzoBenzina(responso, i)+'</h6>';
                        div += '<div class="row">'; //apro la riga
                        if (getBenzServito(responso, i) > 0 || getBenzSelf(responso, i) > 0){
                            div += '<div class="col-xs-'+colonne+'">'; //apro la prima colonna da 3
                            if(getBenzServito(responso, i) > 0){
                                div += '<p>benzina servita: €'+getBenzServito(responso, i)+'</p>';
                            }
                            if (getBenzSelf(responso, i) > 0){
                                if (iBenzina === i){
                                    div += '<p style="color: green" data-toggle="tooltip" title="Benzina più economica!">benzina self: €'+getBenzSelf(responso, i)+'</p>';
                                }else{
                                    div += '<p>benzina self: €'+getBenzSelf(responso, i)+'</p>';
                                }
                            }
                            div += '</div>'; //chiudo la prima colonna da 3
                        }
                        if (getGasolioServito(responso, i) > 0 || getGasolioSelf(responso, i) > 0){
                            div += '<div class="col-xs-'+colonne+'">'; //apro la seconda colonna da 3
                            if (getGasolioServito(responso, i) > 0){
                                div += '<p>gasolio servito: €'+getGasolioServito(responso, i)+'</p>';
                            }
                            if (getGasolioSelf(responso, i) > 0){
                                if (iGasolio === i){
                                    div += '<p style="color: green" data-toggle="tooltip" title="Gasolio più economico!">gasolio self: €'+getGasolioSelf(responso, i)+'</p>';
                                }else{
                                    div += '<p>gasolio self: €'+getGasolioSelf(responso, i)+'</p>';
                                }
                            }
                            div += '</div>'; //chiudo la seconda colonna da 3
                        }
                        if (getGpl(responso, i) > 0){
                            div += '<div class="col-xs-'+colonne+'">'; //apro la terza colonna da 3
                            if (iGpl === i){
                                div += '<p style="color: green" data-toggle="tooltip" title="GPL più economico!">gpl: €'+getGpl(responso, i)+'</p>';
                            }else{
                                div += '<p>gpl: €'+getGpl(responso, i)+'</p>';
                            }
                            div += '</div>'; //chiudo la terza colonna da 3
                        }
                        if (getMetano(responso, i) > 0){
                            div += '<div class="col-xs-'+colonne+'">'; //apro la quarta colonna da 3
                            if (iMetano === i){
                                div += '<p style="color: green" data-toggle="tooltip" title="Metano più economico!">metano: €'+getMetano(responso, i)+'</p>';
                            }else{
                                div += '<p>metano: €'+getMetano(responso, i)+'</p>';
                            }
                            div += '</div>'; //chiudo la quarta colonna da 3
                        }
                        div += '</div>'; //chiudo la riga
                        div += '<a href="infobenzina.html?id='+getIDBenzina(responso, i)+'" class="card-link">I servizi offerti</a>';
                        div += '</div>';
                        div += '</div>';
                        div += '<hr>';
                        //creo il div collapse
                        //carico il div nel contenitore
                        $('#benzine').append(div);
                    }
                }
                $("#loaderBenzine").hide();
            }
        </script>
    </body>
</html>